import{_ as s,a,o as t,ag as n}from"./chunks/framework.Do1Zayaf.js";const u=JSON.parse('{"title":"HPCC Elastic File System (EFS) Storage","description":"","frontmatter":{},"headers":[],"relativePath":"helm/examples/efs/README.md","filePath":"helm/examples/efs/README.md","lastUpdated":1758199950000}'),i={name:"helm/examples/efs/README.md"};function l(o,e,c,p,r,h){return t(),a("div",null,e[0]||(e[0]=[n(`<h1 id="hpcc-elastic-file-system-efs-storage" tabindex="-1">HPCC Elastic File System (EFS) Storage <a class="header-anchor" href="#hpcc-elastic-file-system-efs-storage" aria-label="Permalink to &quot;HPCC Elastic File System (EFS) Storage&quot;">​</a></h1><h1 id="efs-csi-driver" tabindex="-1">EFS CSI Driver <a class="header-anchor" href="#efs-csi-driver" aria-label="Permalink to &quot;EFS CSI Driver&quot;">​</a></h1><p>&quot;examples/efs&quot; requires Elastic FileSystem (EFS) Container Storage Interface (CSI) driver. We provide some scripts to simplify the process. For details please reference <a href="https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html</a> Current implementation only tested successfully with a IAM user. It may need updates for Active Directory Federation Service (ADFS)</p><h2 id="prepare-environment" tabindex="-1">Prepare environment <a class="header-anchor" href="#prepare-environment" aria-label="Permalink to &quot;Prepare environment&quot;">​</a></h2><p>Make sure an EFS file system is available or create an <a href="#efs-file-system">EFS File System</a> before using this chart.<br> Fill in the following information in the efs-env file</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ACCOUNT_ID       # AWS Account ID</span></span>
<span class="line"><span>EKS_NAME         # Elastic Kubernetes Service (EKS) cluster name: kubectl configure get-cluster  (The first part of the name before &quot;.&quot;)</span></span>
<span class="line"><span>EFS_ID           # EFS ID can be found from AWS Console or command-line:</span></span>
<span class="line"><span>                   aws efs describe-file-systems --query &quot;FileSystems[*].FileSystemId&quot; --output text</span></span>
<span class="line"><span>EFS_REGION       # EFS region. We strongly suggest you have the same region for EFS server and EKS cluster</span></span>
<span class="line"><span>EFS_SECURITY_GROUPS  # EFS security group which should be the same as the EKS cluster security group. Also, make sure the security group for the mount targets is the same as this one.</span></span>
<span class="line"><span>EFS_BASE_PATH    # Base directory to mount in the EFS. If you use EFS for multiple HPCC clusters you should set this differently to avoid clashing with the other clusters</span></span>
<span class="line"><span>VPC_ID           # The same VPC ID as the VPC of the EKS cluster</span></span></code></pre></div><h3 id="get-the-efs-id" tabindex="-1">Get the EFS ID <a class="header-anchor" href="#get-the-efs-id" aria-label="Permalink to &quot;Get the EFS ID&quot;">​</a></h3><div class="language-Console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws efs describe-file-systems --region &lt;REGION&gt;</span></span></code></pre></div><p>The output shows &quot;NAME&quot; and FileSystemID</p><h3 id="how-to-get-efs-security-groups" tabindex="-1">How to get EFS security groups <a class="header-anchor" href="#how-to-get-efs-security-groups" aria-label="Permalink to &quot;How to get EFS security groups&quot;">​</a></h3><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws efs describe-mount-targets --file-system-id &lt;EFS ID&gt; --region &lt;EFS region&gt; |  awk -F $&#39;\\t&#39; &#39;{print $7}&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  # For each file-system mount target:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws efs describe-mount-targets-security-groups --mount-target-id &lt;mount target id&gt;  --region &lt;EFS region&gt; |  awk -F $&#39;\\t&#39; &#39;{print $2}&#39;</span></span></code></pre></div><p>Add each unique security group id to the variable &quot;EFS_SECURITY_GROUPS&quot;</p><h2 id="install-efs-csi-driver" tabindex="-1">Install EFS CSI Driver <a class="header-anchor" href="#install-efs-csi-driver" aria-label="Permalink to &quot;Install EFS CSI Driver&quot;">​</a></h2><p>Run the following command under the efs directory:</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>./install-efs-csi-driver.sh</span></span></code></pre></div><p>The script configures the IAM roles and policies, installs the aws-efs-csi-driver, and creates the file for the &quot;aws-efs-auto&quot; storage class. To verify</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">helm list -n kube-system</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                           APP VERSION</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aws-efs-csi-driver      kube-system     1               2022-08-19 17:25:53.6078326 -0400 EDT   deployed        aws-efs-csi-driver-2.2.7        1.4.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kubectl get pod -n kube-system | grep efs-csi</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">efs-csi-controller-594c7f67c7-8zk72   3/3     Running   0          32h</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">efs-csi-controller-594c7f67c7-mncgd   3/3     Running   0          32h</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">efs-csi-node-8g8fk                    3/3     Running   0          32h</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">efs-csi-node-fp8vt                    3/3     Running   0          32h</span></span></code></pre></div><h1 id="storage-for-hpcc-cluster" tabindex="-1">Storage for HPCC cluster <a class="header-anchor" href="#storage-for-hpcc-cluster" aria-label="Permalink to &quot;Storage for HPCC cluster&quot;">​</a></h1><p>There are three available storage life cycles/methods for the HPCC cluster.</p><h2 id="_1-dynamic-storage-with-values-auto-efs-yaml" tabindex="-1">1. Dynamic storage with values-auto-efs.yaml <a class="header-anchor" href="#_1-dynamic-storage-with-values-auto-efs-yaml" aria-label="Permalink to &quot;1. Dynamic storage with values-auto-efs.yaml&quot;">​</a></h2><p>This method uses the storage class &quot;aws-efs-auto&quot; to dynamically create Persistent Volume Claims (PVC). The PVCs are deleted when the HPCC cluster is deleted, meaning that the storage is deleted when the HPCC cluster is deleted. The storage can&#39;t be reused between different HPCC clusters.<br></p><p>Under the efs directory, run the following command to create the &quot;aws-efs-auto&quot; storage class</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kubectl apply -f storageclass.yaml</span></span></code></pre></div><p>To verify</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl get sc</span></span>
<span class="line"><span>NAME            PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span></span>
<span class="line"><span>aws-efs-auto    efs.csi.aws.com         Delete          Immediate              false                  9s</span></span></code></pre></div><p>To deploy the HPCC cluster, navigate to the helm directory and run:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm install myhpcc ./hpcc --set global.image.version=latest -f examples/efs/values-auto-efs.yaml</span></span></code></pre></div><p>To cleanup, run</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm uninstall myhpcc</span></span></code></pre></div><h2 id="_2-static-storage-within-kubernetes-with-values-retained-efs-yaml" tabindex="-1">2. Static storage within Kubernetes with values-retained-efs.yaml <a class="header-anchor" href="#_2-static-storage-within-kubernetes-with-values-retained-efs-yaml" aria-label="Permalink to &quot;2. Static storage within Kubernetes with values-retained-efs.yaml&quot;">​</a></h2><p>In this method, storage lives on the Kubernetes cluster level. It uses the helm chart &quot;hpcc-efs-dynamic-pv&quot; to manually create PVCs. The PVs are dynamically generated. The PVCs will persist after the HPCC cluster is deleted, meaning that the storage can be reused across different HPCC clusters.<br> This method also uses the &quot;aws-efs-auto&quot; storage class. Under the efs directory, run the following command:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kubectl apply -f storageclass.yaml</span></span></code></pre></div><p>The storage needs to be created before starting the HPCC cluster. Under the helm directory, run the following command:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm install awsstorage examples/efs/hpcc-efs-dynamic-pv</span></span></code></pre></div><p>To verify</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl get pvc</span></span>
<span class="line"><span>NAME                                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span>dali-awsstorage-hpcc-efs-pvc         Bound    pvc-400ddbb7-1b89-4468-b416-ffece25aab0d   1Gi        RWO            aws-efs        5m52s</span></span>
<span class="line"><span>data-awsstorage-hpcc-efs-pvc         Bound    pvc-0b99092e-56ba-4c2e-8572-9a5ab4d4da4b   3Gi        RWX            aws-efs        5m52s</span></span>
<span class="line"><span>dll-awsstorage-hpcc-efs-pvc          Bound    pvc-70a470ec-b754-4376-9afb-f1bd499c51ec   1Gi        RWX            aws-efs        5m52s</span></span>
<span class="line"><span>mydropzone-awsstorage-hpcc-efs-pvc   Bound    pvc-9ecd2abc-7713-4639-8da2-91392e636e19   1Gi        RWX            aws-efs        5m52s</span></span>
<span class="line"><span>sasha-awsstorage-hpcc-efs-pvc        Bound    pvc-30c3357c-d982-47f9-ac2c-c1465639b10e   1Gi        RWX            aws-efs        5m52s</span></span></code></pre></div><p>To start the HPCC cluster, run</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  helm install myhpcc ./hpcc --set global.image.version=latest -f examples/efs/values-retained-efs.yaml</span></span></code></pre></div><p>An example values file to be supplied when installing the HPCC chart. NB: Either use the output auto-generated when installing the &quot;hpcc-efs&quot; helm chart, or ensure the names in your values files for the storage types match the PVC names created. The &quot;values-retained-efs.yaml&quot; file expects that helm chart installation name is &quot;awsstorage&quot;. Change the PVC name accordingly if another name is used.<br> To cleanup, run</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm uninstall myhpcc</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm uninstall awsstorage</span></span></code></pre></div><h2 id="_3-static-storage-beyond-kubernetes-with-values-retained-efs-yaml" tabindex="-1">3. Static storage beyond Kubernetes with values-retained-efs.yaml <a class="header-anchor" href="#_3-static-storage-beyond-kubernetes-with-values-retained-efs-yaml" aria-label="Permalink to &quot;3. Static storage beyond Kubernetes with values-retained-efs.yaml&quot;">​</a></h2><p>In this method, the storage lives beyond the Kubernetes cluster. It uses the helm chart &quot;hpcc-efs-static-pv&quot; to manually create PVs and PVCs and to configure access points in EFS with the Kubernetes cluster. This means that even if the Kubernetes cluster is deleted, the storage will remain and can be reused across different Kubernetes clusters.<br> The create-ap.sh script creates five access points in EFS for each of dali, dll, sasha, data, and mydropzone. It also displays a description for each access point. You may need to add additional tags to the access points depending on your organization. For example, for RISK users, the &quot;owner&quot; and &quot;owner_email&quot; tags are required; add these to the script as needed.<br> Once you are ready, under the efs directory run the following command:</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>./create-ap.sh</span></span></code></pre></div><p>Note that running the script again will create five more access points with the same exact specifications. Use the delete-ap.sh to delete all access points.<br> Navigate to hpcc-efs-static-pv -&gt; values.yaml. Paste the EFS ID where it says &quot;efsID&quot; and the access point IDs where it says &quot;apID&quot;. You can get the access point IDs either through the console or from the descriptions after running the create-ap.sh script. Make sure the correct access point IDs correspond to the correct names in the values.yaml.<br></p><p>The storage needs to be created before starting the HPCC cluster. Under the helm directory, run the following command:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm install awsstorage examples/efs/hpcc-efs-static-pv</span></span></code></pre></div><p>To verify</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl get sc</span></span>
<span class="line"><span>NAME             PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span></span>
<span class="line"><span>aws-efs-static   efs.csi.aws.com         Delete          Immediate              false                  110s</span></span></code></pre></div><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl get pv</span></span>
<span class="line"><span>NAME                                CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                        STORAGECLASS     REASON   AGE</span></span>
<span class="line"><span>dali-awsstorage-hpcc-efs-pv         1Gi        RWO            Retain           Bound    default/dali-awsstorage-hpcc-efs-pvc         aws-efs-static            23s</span></span>
<span class="line"><span>data-awsstorage-hpcc-efs-pv         3Gi        RWX            Retain           Bound    default/data-awsstorage-hpcc-efs-pvc         aws-efs-static            23s</span></span>
<span class="line"><span>dll-awsstorage-hpcc-efs-pv          1Gi        RWX            Retain           Bound    default/dll-awsstorage-hpcc-efs-pvc          aws-efs-static            23s</span></span>
<span class="line"><span>mydropzone-awsstorage-hpcc-efs-pv   1Gi        RWX            Retain           Bound    default/mydropzone-awsstorage-hpcc-efs-pvc   aws-efs-static            23s</span></span>
<span class="line"><span>sasha-awsstorage-hpcc-efs-pv        1Gi        RWX            Retain           Bound    default/sasha-awsstorage-hpcc-efs-pvc        aws-efs-static            23s</span></span></code></pre></div><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>kubectl get pvc</span></span>
<span class="line"><span>NAME                                 STATUS   VOLUME                              CAPACITY   ACCESS MODES   STORAGECLASS     AGE</span></span>
<span class="line"><span>dali-awsstorage-hpcc-efs-pvc         Bound    dali-awsstorage-hpcc-efs-pv         1Gi        RWO            aws-efs-static   29s</span></span>
<span class="line"><span>data-awsstorage-hpcc-efs-pvc         Bound    data-awsstorage-hpcc-efs-pv         3Gi        RWX            aws-efs-static   29s</span></span>
<span class="line"><span>dll-awsstorage-hpcc-efs-pvc          Bound    dll-awsstorage-hpcc-efs-pv          1Gi        RWX            aws-efs-static   29s</span></span>
<span class="line"><span>mydropzone-awsstorage-hpcc-efs-pvc   Bound    mydropzone-awsstorage-hpcc-efs-pv   1Gi        RWX            aws-efs-static   29s</span></span>
<span class="line"><span>sasha-awsstorage-hpcc-efs-pvc        Bound    sasha-awsstorage-hpcc-efs-pv        1Gi        RWX            aws-efs-static   29s</span></span></code></pre></div><p>To start the HPCC cluster, run</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  helm install myhpcc ./hpcc --set global.image.version=latest -f examples/efs/values-retained-efs.yaml</span></span></code></pre></div><p>To cleanup, run</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm uninstall myhpcc</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  helm uninstall awsstorage</span></span></code></pre></div><h1 id="efs-file-system" tabindex="-1">EFS File System <a class="header-anchor" href="#efs-file-system" aria-label="Permalink to &quot;EFS File System&quot;">​</a></h1><p>Reference:</p><ul><li><a href="https://docs.aws.amazon.com/efs/latest/ug/gs-step-two-create-efs-resources.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/efs/latest/ug/gs-step-two-create-efs-resources.html</a></li><li><a href="https://hpccsystems.com/blog/Cloud-AWS" target="_blank" rel="noreferrer">https://hpccsystems.com/blog/Cloud-AWS</a> You can use either AWS CLI or the console to create the EFS.</li></ul><h2 id="aws-cli" tabindex="-1">AWS CLI <a class="header-anchor" href="#aws-cli" aria-label="Permalink to &quot;AWS CLI&quot;">​</a></h2><p>If you don&#39;t have AWS CLI reference</p><ul><li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html</a></li></ul><p>For simple setup we recommend you use the same VPC/Subnets and security group for both EFS and EKS</p><h3 id="create-efs-server" tabindex="-1">Create EFS Server <a class="header-anchor" href="#create-efs-server" aria-label="Permalink to &quot;Create EFS Server&quot;">​</a></h3><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws efs create-file-system --throughput-mode bursting --tags &quot;Key=Name,Value=&lt;EFS Name&gt;&quot; --region &lt;REGION&gt;</span></span></code></pre></div><p>The EFS server FQDN will be</p><div class="language-code vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">code</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  &lt;EFS ID&gt;.efs.&lt;REGION&gt;.amazonaws.com</span></span></code></pre></div><h3 id="creating-the-mount-targets" tabindex="-1">Creating the Mount Targets <a class="header-anchor" href="#creating-the-mount-targets" aria-label="Permalink to &quot;Creating the Mount Targets&quot;">​</a></h3><p>Pick a VPC in the the same region of EFS server</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws ec2 describe-vpcs --region &lt;REGION&gt;</span></span></code></pre></div><p>The output shows the VPC IDs. Get all the subnets of the VPC</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws ec2 describe-subnets --region &lt;REGION&gt; --fileters &quot;Name=vpc-id,Values=&lt;VPC ID&gt;&quot;</span></span></code></pre></div><p>The output shows &quot;AvailabilityZone&quot; and &quot;Subnets ID&quot;<br> We recommend you use these all or subets of these &quot;AvailabalityZone&quot; and &quot;Subnet IDs&quot; to create EKS cluster with the option &quot;--managed&quot;. It will be easier to configure EFS and EKS.</p><p>To create the mount target:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws efs create-mount-target --region &lt;REGION&gt; --file-system-id &lt;EFS ID&gt; --subnet-id &lt;Subnet id&gt;</span></span></code></pre></div><p>Repeat this for all subnets. Usually an AWS EKS cluster needs at least two available zones (subnets). If you are not sure, create mount targets for all zones.</p><p>To display the mount targets:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  aws efs describe-mount-targets --region &lt;REGION&gt; --file-system-id &lt;EFS ID&gt;</span></span></code></pre></div><h2 id="console" tabindex="-1">Console <a class="header-anchor" href="#console" aria-label="Permalink to &quot;Console&quot;">​</a></h2><h3 id="create-efs-server-1" tabindex="-1">Create EFS Server <a class="header-anchor" href="#create-efs-server-1" aria-label="Permalink to &quot;Create EFS Server&quot;">​</a></h3><p>Navigate to the EFS service and click &quot;Create file system&quot;. Select the same VPC as the one your EKS cluster is running in.</p><h3 id="configuring-the-mount-targets" tabindex="-1">Configuring the Mount Targets <a class="header-anchor" href="#configuring-the-mount-targets" aria-label="Permalink to &quot;Configuring the Mount Targets&quot;">​</a></h3><p>Click on the file system you just created and navigate to &quot;Network&quot;. Your mount targets should be displayed.<br> Click on &quot;Manage&quot;, and you should see that the security groups for the mount targets are the default security group. Replace these with the EKS cluster security group. To find the EKS cluster security group navigate to EKS. Click on your cluster. Click on &quot;Networking&quot;, and find the security group displayed under &quot;Cluster security group&quot;. After replacing the default security group for all mount targets, save your changes.</p>`,81)]))}const g=s(i,[["render",l]]);export{u as __pageData,g as default};
